name: :rocket:Publish
on:
  push:
    branches: ['main']
â€‹env:
    REGISTRY: ghcr.io
    IMAGE_NAME: ${{ github.repository }}
â€‹jobs:
    build-and-push-image:
      runs-on: ubuntu-late×“×
      permissions: write-all
    steps:
        - name: :open_file_folder:Checkout repository
          uses: actions/checkout@v4
          
        - name: :electric_plug:Login to the Container registry
          uses: docker/login-action@v1
          with:
            registry: ${{ env.REGISTRY }}
            username: ${{ github.actor }}
            password: ${{ secrets.GITHUB_TOKEN }}
  
        - name: :building_construction:Build Image
          run: |
            docker build . --tag ghcr.io/leahlandau/try:latest
            docker push ghcr.io/leahlandau/try:latest
        - name: ğŸ”Œ Log in to Azure
          uses: azure/login@v1
          with:
            creds: ${{ secrets.AZURE_CREDENTIALS }}
            
        - name: ğŸš€ Build and deploy Container App
          uses: azure/container-apps-deploy-action@v1
          with:
            resource-group: ${{ secrets.AZURE_RESOURCE_GROUP }}
            name: ${{ functioapp1 }}
            image: ${{ ghcr.io/leahlandau/try:latest }}
            registry-username: ${{ github.actor }}
            registry-password: ${{ secrets.GITHUB_TOKEN }}
â€‹
